# WeakMap —Ç–∞ WeakSet

–Ø–∫ –º–∏ –∑–Ω–∞—î–º–æ –∑ —Ä–æ–∑–¥—ñ–ª—É <info:garbage-collection>, JavaScript –∑–±–µ—Ä—ñ–≥–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è –≤ –ø–∞–º'—è—Ç—ñ –¥–æ —Ç–∏—Ö –ø—ñ—Ä, –ø–æ–∫–∏ –≤–æ–Ω–∏ –¥–æ—Å—è–∂–Ω—ñ (—Ç–æ–±—Ç–æ, —Ü—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ).

–ù–∞–ø—Ä–∏–∫–ª–∞–¥:
```js
let john = { name: "John" };

// –æ–±'—î–∫—Ç –¥–æ—Å—Ç—É–ø–Ω–∏–π, john -- —Ü–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –Ω—å–æ–≥–æ
// –ø–µ—Ä–µ–ø–∏—à–µ–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
john = null;

*!*
// –æ–±'—î–∫—Ç –±—É–¥–µ –≤–∏–¥–∞–ª–µ–Ω–æ –∑ –ø–∞–º'—è—Ç—ñ
*/!*
```

–ó–∞–∑–≤–∏—á–∞–π –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –æ–±'—î–∫—Ç–∞, –µ–ª–µ–º–µ–Ω—Ç–∏ –º–∞—Å–∏–≤—É –∞–±–æ —ñ–Ω—à–æ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö –≤–≤–∞–∂–∞—é—Ç—å—Å—è –¥–æ—Å—è–∂–Ω–∏–º–∏ —ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –ø–∞–º'—è—Ç—ñ –¥–æ —Ç–∏—Ö –ø—ñ—Ä, –ø–æ–∫–∏ —Ü—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö –º—ñ—Å—Ç–∏—Ç—å—Å—è –≤ –ø–∞–º'—è—Ç—ñ.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ –º–∏ –ø–æ–º—ñ—Å—Ç–∏–º–æ –æ–±'—î–∫—Ç –≤ –º–∞—Å–∏–≤, —Ç–æ –¥–æ —Ç–∏—Ö –ø—ñ—Ä, –ø–æ–∫–∏ –º–∞—Å–∏–≤ —ñ—Å–Ω—É—î, –æ–±'—î–∫—Ç —Ç–∞–∫–æ–∂ –±—É–¥–µ —ñ—Å–Ω—É–≤–∞—Ç–∏ –≤ –ø–∞–º'—è—Ç—ñ, –Ω–µ –¥–∏–≤–ª—è—á–∏—Å—å –Ω–∞ —Ç–µ, —â–æ —ñ–Ω—à–∏—Ö –ø–æ—Å–∏–ª–∞–Ω—å –Ω–∞ –Ω—å–æ–≥–æ –Ω–µ–º–∞—î.

–Ø–∫ —Ç—É—Ç:

```js
let john = { name: "John" };

let array = [ john ];

john = null; // –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –æ–±'—î–∫—Ç

*!*
// –æ–±'—î–∫—Ç john –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ –º–∞—Å–∏–≤—ñ, —Ç–æ–º—É –≤—ñ–Ω –Ω–µ –±—É–¥–µ –≤–∏–¥–∞–ª–µ–Ω–∏–π –æ—á–∏—Å–Ω–∏–∫–æ–º —Å–º—ñ—Ç—Ç—è
// –º–∏ –º–æ–∂–µ–º–æ –≤–∑—è—Ç–∏ –π–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è —è–∫ array[0]
*/!*
```

–ê–Ω–∞–ª–æ–≥—ñ—á–Ω–æ, —è–∫—â–æ –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –æ–±'—î–∫—Ç —è–∫ –∫–ª—é—á –≤ `Map`, —Ç–æ –¥–æ —Ç–∏—Ö –ø—ñ—Ä, –ø–æ–∫–∏ —ñ—Å–Ω—É—î` Map`, —Ç–∞–∫–æ–∂ –±—É–¥–µ —ñ—Å–Ω—É–≤–∞—Ç–∏ —ñ —Ü–µ–π –æ–±'—î–∫—Ç. –í—ñ–Ω –∑–∞–π–º–∞—î –º—ñ—Å—Ü–µ –≤ –ø–∞–º'—è—Ç—ñ —ñ –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –∑–Ω–∏—â–µ–Ω–∏–π –æ—á–∏—Å–Ω–∏–∫–æ–º —Å–º—ñ—Ç—Ç—è.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥:

```js
let john = { name: "John" };

let map = new Map();
map.set(john, "...");

john = null; // –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –æ–±'—î–∫—Ç

*!*
// john –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –æ–±'—î–∫—Ç–∞ map,
// –≤—ñ–Ω –¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞–º —á–µ—Ä–µ–∑ map.keys()
*/!*
```

`WeakMap` - –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤–æ —ñ–Ω—à–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ —Ü—å–æ–º—É –∞—Å–ø–µ–∫—Ç—ñ. –í–æ–Ω–∞ –Ω–µ –∑–∞–ø–æ–±—ñ–≥–∞—î –≤–∏–¥–∞–ª–µ–Ω–Ω—é –æ–±'—î–∫—Ç—ñ–≤ –æ—á–∏—Å–Ω–∏–∫–æ–º —Å–º—ñ—Ç—Ç—è, –∫–æ–ª–∏ —Ü—ñ –æ–±'—î–∫—Ç–∏ –≤–∏—Å—Ç—É–ø–∞—é—Ç—å –≤ —è–∫–æ—Å—Ç—ñ –∫–ª—é—á—ñ–≤.

–î–∞–≤–∞–π—Ç–µ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ —Ü–µ –Ω–∞ –ø—Ä–∏–∫–ª–∞–¥–∞—Ö:

## WeakMap

–ü–µ—Ä—à–∞ –π–æ–≥–æ –≤—ñ–¥–º—ñ–Ω–∞ –≤—ñ–¥ `Map` –≤ —Ç–æ–º—É, —â–æ –∫–ª—é—á—ñ –≤` WeakMap` –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –æ–±'—î–∫—Ç–∞–º–∏, –∞ –Ω–µ –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏:

```js run
let weakMap = new WeakMap();

let obj = {};

weakMap.set(obj, "ok"); // –ø—Ä–∞—Ü—é—î (–æ–±'—î–∫—Ç –≤ —è–∫–æ—Å—Ç—ñ –∫–ª—é—á–∞)

*!*
// –Ω–µ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä—è–¥–æ–∫ –≤ —è–∫–æ—Å—Ç—ñ –∫–ª—é—á–∞
weakMap.set("test", "Whoops"); // –ü–æ–º–∏–ª–∫–∞, –±–æ "test" –Ω–µ –æ–±'—î–∫—Ç
*/!*
```

–¢–µ–ø–µ—Ä, —è–∫—â–æ –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –æ–±'—î–∫—Ç –≤ —è–∫–æ—Å—Ç—ñ –∫–ª—é—á–∞ —ñ —è–∫—â–æ –±—ñ–ª—å—à–µ –Ω–µ–º–∞—î –ø–æ—Å–∏–ª–∞–Ω—å –Ω–∞ —Ü–µ–π –æ–±'—î–∫—Ç, —Ç–æ –≤—ñ–Ω –±—É–¥–µ –≤–∏–¥–∞–ª–µ–Ω–∏–π –∑ –ø–∞–º'—è—Ç—ñ (—ñ –∑ –æ–±'—î–∫—Ç–∞ `WeakMap`) –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.

```js
let john = { name: "John" };

let weakMap = new WeakMap();
weakMap.set(john, "...");

john = null; // –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –æ–±'—î–∫—Ç

// –æ–±'—î–∫—Ç john –≤–∏–¥–∞–ª–µ–Ω–∏–π –∑ –ø–∞–º'—è—Ç—ñ
```

–ü–æ—Ä—ñ–≤–Ω—è–π—Ç–µ —Ü—é –ø–æ–≤–µ–¥—ñ–Ω–∫—É –∑ –ø–æ–≤–µ–¥—ñ–Ω–∫–æ—é –∑–≤–∏—á–∞–π–Ω–æ–≥–æ `Map`, –ø—Ä–∏–∫–ª–∞–¥ —è–∫–æ–≥–æ –±—É–≤ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–π —Ä–∞–Ω—ñ—à–µ. –¢–µ–ø–µ—Ä `john` —ñ—Å–Ω—É—î —Ç—ñ–ª—å–∫–∏ —è–∫ –∫–ª—é—á –≤` WeakMap` —ñ –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–∏–π –∑–≤—ñ–¥—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.

`WeakMap` –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –ø–µ—Ä–µ–±—ñ—Ä —ñ –º–µ—Ç–æ–¥–∏` keys () `,` values () `,` entries () `, —Ç–∞–∫ —â–æ –Ω–µ–º–∞—î —Å–ø–æ—Å–æ–±—É –≤–∑—è—Ç–∏ –≤—Å—ñ –∫–ª—é—á—ñ –∞–±–æ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ –Ω—å–æ–≥–æ.

–í `WeakMap` –ø—Ä–∏—Å—É—Ç–Ω—ñ —Ç—ñ–ª—å–∫–∏ —Ç–∞–∫—ñ –º–µ—Ç–æ–¥–∏:

- `weakMap.get(key)`
- `weakMap.set(key, value)`
- `weakMap.delete(key)`
- `weakMap.has(key)`

–î–æ —á–æ–≥–æ —Ç–∞–∫—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è? –ß–µ—Ä–µ–∑ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ —Ç–µ—Ö–Ω—ñ—á–Ω–æ—ó —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó. –Ø–∫—â–æ –æ–±'—î–∫—Ç —Å—Ç–∞–Ω–µ –Ω–µ–¥–æ—Å—è–∂–Ω–∏–π (—è–∫ –æ–±'—î–∫—Ç `john` –≤ –ø—Ä–∏–∫–ª–∞–¥—ñ –≤–∏—â–µ), —Ç–æ –≤—ñ–Ω –±—É–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–∏–π –æ—á–∏—Å–Ω–∏–∫–æ–º —Å–º—ñ—Ç—Ç—è. –ê–ª–µ –Ω–µ–º–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó, *–∫–æ–ª–∏ —Å–∞–º–µ –≤—ñ–¥–±—É–¥–µ—Ç—å—Å—è —Ü—è –æ—á–∏—â–µ–Ω–Ω—è*.

–†—ñ—à–µ–Ω–Ω—è –ø—Ä–æ —Ç–µ, –∫–æ–ª–∏ —Ä–æ–±–∏—Ç–∏ –∑–±—ñ—Ä–∫—É —Å–º—ñ—Ç—Ç—è, –ø—Ä–∏–π–º–∞—î –¥–≤–∏–∂–æ–∫ JavaScript. –í—ñ–Ω –º–æ–∂–µ –≤–≤–∞–∂–∞—Ç–∏ –∑–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω–µ —è–∫ –≤–∏–¥–∞–ª–∏—Ç–∏ –æ–±'—î–∫—Ç –ø—Ä—è–º–æ –∑–∞—Ä–∞–∑, —Ç–∞–∫ —ñ –≤—ñ–¥–∫–ª–∞—Å—Ç–∏ —Ü—é –æ–ø–µ—Ä–∞—Ü—ñ—é, —â–æ–± –≤–∏–¥–∞–ª–∏—Ç–∏ –±—ñ–ª—å—à—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –æ–±'—î–∫—Ç—ñ–≤ –∑–∞ —Ä–∞–∑ –ø—ñ–∑–Ω—ñ—à–µ. –¢–∞–∫ —â–æ —Ç–µ—Ö–Ω—ñ—á–Ω–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –≤ –∫–æ–ª–µ–∫—Ü—ñ—ó `WeakMap` –Ω–µ–≤—ñ–¥–æ–º–æ. –î–≤–∏–∂–æ–∫ –º–æ–∂–µ –ø—Ä–æ–≤–µ—Å—Ç–∏ –æ—á–∏—â–µ–Ω–Ω—è –≤—ñ–¥—Ä–∞–∑—É —á–∏ –ø–æ—Ç—ñ–º, –∞–±–æ –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ —á–∞—Å—Ç–∫–æ–≤–æ. –ó —Ü—ñ—î—ó –ø—Ä–∏—á–∏–Ω–∏ –º–µ—Ç–æ–¥–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –≤—Å—ñ—Ö –≤—ñ–¥—Ä–∞–∑—É –∫–ª—é—á—ñ–≤/–∑–Ω–∞—á–µ–Ω—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ.

–ê–ª–µ –¥–ª—è —á–æ–≥–æ –∂ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ç–∞–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö?

## –ü—Ä–∏–∫–ª–∞–¥: –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ

–í –æ—Å–Ω–æ–≤–Ω–æ–º—É, `WeakMap` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ —è–∫–æ—Å—Ç—ñ *–¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞ –¥–∞–Ω–∏—Ö*.

–Ø–∫—â–æ –º–∏ –ø—Ä–∞—Ü—é—î–º–æ –∑ –æ–±'—î–∫—Ç–æ–º, —è–∫–∏–π "–Ω–∞–ª–µ–∂–∏—Ç—å" —ñ–Ω—à–æ–º—É –∫–æ–¥—É, –º–æ–∂–ª–∏–≤–æ –Ω–∞–≤—ñ—Ç—å —Å—Ç–æ—Ä–æ–Ω–Ω—ñ–π –±—ñ–±–ª—ñ–æ—Ç–µ—Ü—ñ, —ñ —Ö–æ—á–µ–º–æ –∑–±–µ—Ä–µ–≥—Ç–∏ —É —Å–µ–±–µ —è–∫—ñ—Å—å –¥–∞–Ω—ñ –¥–ª—è –Ω—å–æ–≥–æ, —è–∫—ñ –ø–æ–≤–∏–Ω–Ω—ñ —ñ—Å–Ω—É–≤–∞—Ç–∏ –ª–∏—à–µ –ø–æ–∫–∏ —ñ—Å–Ω—É—î —Ü–µ–π –æ–±'—î–∫—Ç, —Ç–æ `WeakMap` - —è–∫—Ä–∞–∑ —Ç–µ, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ.

–ú–∏ –∫–ª–∞–¥–µ–º–æ —Ü—ñ –¥–∞–Ω—ñ –≤ `WeakMap`, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –æ–±'—î–∫—Ç —è–∫ –∫–ª—é—á, —ñ –∫–æ–ª–∏ –æ—á–∏—Å–Ω–∏–∫ —Å–º—ñ—Ç—Ç—è –≤–∏–¥–∞–ª–∏—Ç—å –æ–±'—î–∫—Ç–∏ –∑ –ø–∞–º'—è—Ç—ñ, –∞—Å–æ—Ü—ñ–π–æ–≤–∞–Ω—ñ –∑ –Ω–∏–º–∏ –¥–∞–Ω—ñ —Ç–µ–∂ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–Ω–∏–∫–Ω—É—Ç—å.

```js
weakMap.set(john, "—Å–µ–∫—Ä–µ—Ç–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏");
// —è–∫—â–æ john –ø–æ–º—Ä–µ, "—Å–µ–∫—Ä–µ—Ç–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏" –±—É–¥—É—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–Ω–∏—â–µ–Ω—ñ
```

–î–∞–≤–∞–π—Ç–µ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ –æ–¥–∏–Ω –ø—Ä–∏–∫–ª–∞–¥.

–ü—Ä–∏–ø—É—Å—Ç–∏–º–æ, —É –Ω–∞—Å —î –∫–æ–¥, —è–∫–∏–π –≤–µ–¥–µ –æ–±–ª—ñ–∫ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—å –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ –∫–æ–ª–µ–∫—Ü—ñ—ó `Map`: –æ–±'—î–∫—Ç, —è–∫–∏–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —î –∫–ª—é—á–µ–º, –∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–∑–∏—Ç—ñ–≤ - –∑–Ω–∞—á–µ–Ω–Ω—è–º. –ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Å –ø–æ–∫–∏–¥–∞—î (–π–æ–≥–æ –æ–±'—î–∫—Ç –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –æ—á–∏—Å–Ω–∏–∫–æ–º —Å–º—ñ—Ç—Ç—è), —Ç–æ –±—ñ–ª—å—à–µ –Ω–µ–º–∞—î —Å–µ–Ω—Å—É –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –ª—ñ—á–∏–ª—å–Ω–∏–∫ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—å.

–û—Å—å –ø—Ä–∏–∫–ª–∞–¥ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—å –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º `Map`:

```js
// üìÅ visitsCount.js
let visitsCountMap = new Map(); // map: –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á => —á–∏—Å–ª–æ –≤—ñ–∑–∏—Ç—ñ–≤

// –∑–±—ñ–ª—å—à—É—î–º–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫
function countUser(user) {
  let count = visitsCountMap.get(user) || 0;
  visitsCountMap.set(user, count + 1);
}
```

–ê –æ—Å—å —ñ–Ω—à–∞ —á–∞—Å—Ç–∏–Ω–∞ –∫–æ–¥—É, –º–æ–∂–ª–∏–≤–æ, –≤ —ñ–Ω—à–æ–º—É —Ñ–∞–π–ª—ñ, —è–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `countUser`:

```js
// üìÅ main.js
let john = { name: "John" };

countUser(john); // –≤–µ–¥–µ–º–æ –ø—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—å

// –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ–∫–∏–Ω—É–≤ –Ω–∞—Å
john = null;
```

–¢–µ–ø–µ—Ä –æ–±'—î–∫—Ç `john` –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –≤–∏–ª—É—á–µ–Ω–∏–π –æ—á–∏—Å–Ω–∏–∫–æ–º —Å–º—ñ—Ç—Ç—è, –∞–ª–µ –≤—ñ–Ω –ø—Ä–æ–¥–æ–≤–∂—É—î –∑–∞–ª–∏—à–∞—Ç–∏—Å—è –≤ –ø–∞–º'—è—Ç—ñ, —Ç–∞–∫ —è–∫ —î –∫–ª—é—á–µ–º –≤` visitsCountMap`.

–ù–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ—á–∏—â–∞—Ç–∏ `visitsCountMap` –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –æ–±'—î–∫—Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —ñ–Ω–∞–∫—à–µ –∫–æ–ª–µ–∫—Ü—ñ—è –±—É–¥–µ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ –∑—Ä–æ—Å—Ç–∞—Ç–∏. –ü–æ–¥—ñ–±–Ω–∞ –æ—á–∏—â–µ–Ω–Ω—è –º–æ–∂–µ –±—É—Ç–∏ –Ω–µ–∑—Ä—É—á–Ω–∞ –≤ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø—Ä–∏ —Å–∫–ª–∞–¥–Ω—ñ–π –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—ñ –¥–æ–¥–∞—Ç–∫—É.

–ü—Ä–æ–±–ª–µ–º–∏ –º–æ–∂–Ω–∞ —É–Ω–∏–∫–Ω—É—Ç–∏, —è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `WeakMap`:

```js
// üìÅ visitsCount.js
let visitsCountMap = new WeakMap(); // weakmap: –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á => —á–∏—Å–ª–æ –≤—ñ–∑–∏—Ç—ñ–≤

// –∑–±—ñ–ª—å—à—É—î–º–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫
function countUser(user) {
  let count = visitsCountMap.get(user) || 0;
  visitsCountMap.set(user, count + 1);
}
```

–¢–µ–ø–µ—Ä –Ω–µ–º–∞—î –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –≤—Ä—É—á–Ω—É –æ—á–∏—â–∞—Ç–∏ `visitsCountMap`. –ü—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –æ–±'—î–∫—Ç `john` —Å—Ç–∞–≤ –Ω–µ–¥–æ—Å—è–∂–Ω–∏–π —ñ–Ω—à–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏, –∫—Ä—ñ–º —è–∫ —á–µ—Ä–µ–∑` WeakMap`, –≤—ñ–Ω –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –∑ –ø–∞–º'—è—Ç—ñ —Ä–∞–∑–æ–º –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø–æ —Ç–∞–∫–æ–º—É –∫–ª—é—á—É –∑ `WeakMap`.

## –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è

–Ü–Ω—à–∞ —á–∞—Å—Ç–∞ —Å—Ñ–µ—Ä–∞ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è - —Ü–µ –∫–µ—à—É–≤–∞–Ω–Ω—è, –∫–æ–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–∫–ª–∏–∫—É —Ñ—É–Ω–∫—Ü—ñ—ó –ø–æ–≤–∏–Ω–µ–Ω –¥–µ—Å—å –∑–∞–ø–∞–º'—è—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è ("–∫–µ—à—É–≤–∞—Ç–∏—Å—è") –¥–ª—è —Ç–æ–≥–æ, —â–æ–± –ø–æ–¥–∞–ª—å—à—ñ —ó—ó –≤–∏–∫–ª–∏–∫–∏ –Ω–∞ —Ç–æ–º—É –∂ –æ–±'—î–∫—Ç—ñ –º–æ–≥–ª–∏ –ø—Ä–æ—Å—Ç–æ –±—Ä–∞—Ç–∏ –≤–∂–µ –≥–æ—Ç–æ–≤–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –π–æ–≥–æ.

–î–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –º–∏ –º–æ–∂–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `Map`, –æ—Å—å —Ç–∞–∫:

```js run
// üìÅ cache.js
let cache = new Map();

// –æ–±—á–∏—Å–ª—é—î–º–æ —ñ –∑–∞–ø–∞–º'—è—Ç–æ–≤—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
function process(obj) {
  if (!cache.has(obj)) {
    let result = /* —Ç—É—Ç —è–∫—ñ—Å—å –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –¥–ª—è –æ–±'—î–∫—Ç–∞ */ obj;

    cache.set(obj, result);
  }

  return cache.get(obj);
}

*!*
// –¢–µ–ø–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ process () –≤ —ñ–Ω—à–æ–º—É —Ñ–∞–π–ª—ñ:
*/!*

// üìÅ main.js
let obj = {/* –ø—Ä–∏–ø—É—Å—Ç–∏–º–æ, —É –Ω–∞—Å —î —è–∫–∏–π—Å—å –æ–±'—î–∫—Ç */};

let result1 = process(obj); // –æ–±—á–∏—Å–ª–µ–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

// ...–ø—ñ–∑–Ω—ñ—à–µ, –∑ —ñ–Ω—à–æ–≥–æ –º—ñ—Å—Ü—è –≤ –∫–æ–¥—ñ...
let result2 = process(obj); // —Ä–∞–Ω—ñ—à–µ –æ–±—á–∏—Å–ª–µ–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∑—è—Ç–∏–π –∑ –∫–µ—à–∞

// ...–ø—ñ–∑–Ω—ñ—à–µ, –∫–æ–ª–∏ –æ–±'—î–∫—Ç –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω:
obj = null;

alert(cache.size); // 1 (–£–ø—Å! –û–±'—î–∫—Ç –≤—Å–µ —â–µ –≤ –∫–µ—à—ñ, –∑–∞–π–º–∞—î –ø–∞–º'—è—Ç—å!)
```

–ë–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤—ñ –≤–∏–∫–ª–∏–∫–∏ `process (obj)` –∑ —Ç–∏–º –∂–µ —Å–∞–º–∏–º –æ–±'—î–∫—Ç–æ–º –≤ —è–∫–æ—Å—Ç—ñ –∞—Ä–≥—É–º–µ–Ω—Ç—É –≤–µ–¥—É—Ç—å –¥–æ —Ç–æ–≥–æ, —â–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –≤ –ø–µ—Ä—à–∏–π —Ä–∞–∑, –∞ –ø–æ—Ç—ñ–º –Ω–∞—Å—Ç—É–ø–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ –±–µ—Ä—É—Ç—å –π–æ–≥–æ –∑ –∫–µ—à–∞. –ù–µ–¥–æ–ª—ñ–∫–æ–º —î —Ç–µ, —â–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤—Ä—É—á–Ω—É –æ—á–∏—â–∞—Ç–∏ `cache` –≤—ñ–¥ –Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤.

–ê–ª–µ —è–∫—â–æ –º–∏ –±—É–¥–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `WeakMap` –∑–∞–º—ñ—Å—Ç—å` Map`, —Ç–æ —Ü—è –ø—Ä–æ–±–ª–µ–º–∞ –∑–Ω–∏–∫–Ω–µ: –∑–∞–∫–µ—à–∏—Ä—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –±—É–¥—É—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª–µ–Ω—ñ –∑ –ø–∞–º'—è—Ç—ñ –æ—á–∏—Å–Ω–∏–∫–æ–º —Å–º—ñ—Ç—Ç—è.

```js run
// üìÅ cache.js
*!*
let cache = new WeakMap();
*/!*

// –æ–±—á–∏—Å–ª—é—î–º–æ —ñ –∑–∞–ø–∞–º'—è—Ç–æ–≤—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
function process(obj) {
  if (!cache.has(obj)) {
    let result = /* –æ–±—á–∏—Å–ª—é—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –æ–±'—î–∫—Ç–∞ */ obj;

    cache.set(obj, result);
  }

  return cache.get(obj);
}

// üìÅ main.js
let obj = {/* —è–∫–∏–π—Å—å –æ–±'—î–∫—Ç */};

let result1 = process(obj);
let result2 = process(obj);

// ...–ø—ñ–∑–Ω—ñ—à–µ, –∫–æ–ª–∏ –æ–±'—î–∫—Ç –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω:
obj = null;

// –ù–µ–º–∞—î –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –æ—Ç—Ä–∏–º–∞—Ç–∏ cache.size, —Ç–∞–∫ —è–∫ —Ü–µ WeakMap,
// –∞–ª–µ –≤—ñ–Ω –¥–æ—Ä—ñ–≤–Ω—é—î 0 –∞–±–æ —Å–∫–æ—Ä–æ –±—É–¥–µ –¥–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ 0
// –ö–æ–ª–∏ –æ—á–∏—Å–Ω–∏–∫ —Å–º—ñ—Ç—Ç—è –≤–∏–¥–∞–ª—è—î obj, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ –Ω–∏–º –¥–∞–Ω—ñ –∑ –∫–µ—à–∞ —Ç–µ–∂ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è
```

## WeakSet

–ö–æ–ª–µ–∫—Ü—ñ—è `WeakSet` –ø–æ–≤–æ–¥–∏—Ç—å—Å—è —Å—Ö–æ–∂–µ:

- –í–æ–Ω–∞ –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–∞ `Set`, –∞–ª–µ –º–∏ –º–æ–∂–µ–º–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –≤ `WeakSet` —Ç—ñ–ª—å–∫–∏ –æ–±'—î–∫—Ç–∏ (–Ω–µ –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è).
- –û–±'—î–∫—Ç –ø—Ä–∏—Å—É—Ç–Ω—ñ–π —Ç—ñ–ª—å–∫–∏ –¥–æ —Ç–∏—Ö –ø—ñ—Ä, –ø–æ–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–µ—Å—å —â–µ.
- –Ø–∫ —ñ `Set`, –ø—ñ–¥—Ç—Ä–∏–º—É—î `add`, `has` —ñ `delete`, –∞–ª–µ –Ω–µ `size`,`keys () `—ñ –Ω–µ —î –ø–µ—Ä–µ–±–∏—Ä–∞—î–º–æ—é.

–ë—É–¥—É—á–∏ "—Å–ª–∞–±–∫–æ—é" –≤–µ—Ä—Å—ñ—î—é –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö, –≤–æ–Ω–∞ —Ç–µ–∂ —Å–ª—É–∂–∏—Ç—å –≤ —è–∫–æ—Å—Ç—ñ –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞. –ê–ª–µ –Ω–µ –¥–ª—è –¥–æ–≤—ñ–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö, –∞ —Å–∫–æ—Ä—ñ—à–µ –¥–ª—è –∑–Ω–∞—á–µ–Ω—å —Ç–∏–ø—É "—Ç–∞–∫ / –Ω—ñ". –ü—Ä–∏—Å—É—Ç–Ω—ñ—Å—Ç—å –≤ `WeakSet` –º–æ–∂–µ —â–æ—Å—å —Å–∫–∞–∑–∞—Ç–∏ –Ω–∞–º –ø—Ä–æ –æ–±'—î–∫—Ç.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –º–∏ –º–æ–∂–µ–º–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤ `WeakSet` –¥–ª—è –æ–±–ª—ñ–∫—É —Ç–∏—Ö, —Ö—Ç–æ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–≤ –Ω–∞—à —Å–∞–π—Ç:

```js run
let visitedSet = new WeakSet();

let john = { name: "John" };
let pete = { name: "Pete" };
let mary = { name: "Mary" };

visitedSet.add(john); // John –≤—ñ–¥–≤—ñ–¥–∞–≤ –Ω–∞—Å
visitedSet.add(pete); // –ü–æ—Ç—ñ–º Pete
visitedSet.add(john); // John –∑–Ω–æ–≤—É

// visitedSet –ó–∞—Ä–∞–∑ —É—Ç—Ä–∏–º—É—î –¥–≤–æ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

// –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ, —á–∏ –∑–∞—Ö–æ–¥–∏–≤ John?
alert(visitedSet.has(john)); // true

// –ø–µ—Ä–µ–≤—ñ—Ä–∏–º–æ, —á–∏ –∑–∞—Ö–æ–¥–∏–ª–∞ –úary?
alert(visitedSet.has(mary)); // false

john = null;

// —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö visitedSet –±—É–¥–µ –æ—á–∏—â–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
```

–ù–∞–π–±—ñ–ª—å—à –∑–Ω–∞—á–Ω–∏–º –æ–±–º–µ–∂–µ–Ω–Ω—è–º `WeakMap` —ñ` WeakSet` —î —Ç–µ, —â–æ —ó—Ö –Ω–µ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–±—Ä–∞—Ç–∏ –∞–±–æ –≤–∑—è—Ç–∏ –≤–µ—Å—å –≤–º—ñ—Å—Ç. –¶–µ –º–æ–∂–µ –¥–æ—Å—Ç–∞–≤–ª—è—Ç–∏ –Ω–µ–∑—Ä—É—á–Ω–æ—Å—Ç—ñ, –∞–ª–µ –Ω–µ –∑–∞–≤–∞–∂–∞—î `WeakMap / WeakSet` –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —ó—Ö –≥–æ–ª–æ–≤–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è - –±—É—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º —Å—Ö–æ–≤–∏—â–µ–º –¥–∞–Ω–∏—Ö –¥–ª—è –æ–±'—î–∫—Ç—ñ–≤, –∫–µ—Ä–æ–≤–∞–Ω–∏—Ö –∑ —è–∫–∏—Ö–æ—Å—å —ñ–Ω—à–∏—Ö –º—ñ—Å—Ü—å –≤ –∫–æ–¥—ñ.

## –ü—ñ–¥—Å—É–º–æ–∫

`WeakMap` - —Ü–µ `Map`-–ø–æ–¥—ñ–±–Ω–∞ –∫–æ–ª–µ–∫—Ü—ñ—è, —â–æ –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤ —è–∫–æ—Å—Ç—ñ –∫–ª—é—á—ñ–≤ —Ç—ñ–ª—å–∫–∏ –æ–±'—î–∫—Ç–∏, —ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª—è—î —ó—Ö —Ä–∞–∑–æ–º –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏, —è–∫ —Ç—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ —Å—Ç–∞—é—Ç—å –Ω–µ–¥–æ—Å—è–∂–Ω–∏–º–∏ —ñ–Ω—à–∏–º–∏ —à–ª—è—Ö–∞–º–∏.

`WeakSet` - —Ü–µ `Set`-–ø–æ–¥—ñ–±–Ω–∞ –∫–æ–ª–µ–∫—Ü—ñ—è, —è–∫–∞ –∑–±–µ—Ä—ñ–≥–∞—î —Ç—ñ–ª—å–∫–∏ –æ–±'—î–∫—Ç–∏ —ñ –≤–∏–¥–∞–ª—è—î —ó—Ö, —è–∫ —Ç—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ —Å—Ç–∞—é—Ç—å –Ω–µ–¥–æ—Å—è–∂–Ω–∏–º–∏ —ñ–Ω—à–∏–º–∏ —à–ª—è—Ö–∞–º–∏.

–û–±–∏–¥–≤—ñ —Ü—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å –º–µ—Ç–æ–¥–∏ —ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ, —â–æ –ø—Ä–∞—Ü—é—é—Ç—å –∑ —É—Å—ñ–º –≤–º—ñ—Å—Ç–æ–º –≤—ñ–¥—Ä–∞–∑—É –∞–±–æ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ä–æ–∑–º—ñ—Ä –∫–æ–ª–µ–∫—Ü—ñ—ó. –ú–æ–∂–ª–∏–≤—ñ —Ç—ñ–ª—å–∫–∏ –æ–ø–µ—Ä–∞—Ü—ñ—ó –Ω–∞ –æ–∫—Ä–µ–º–æ–º—É –µ–ª–µ–º–µ–Ω—Ç—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó.

`WeakMap` —ñ `WeakSet` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —è–∫ –¥–æ–ø–æ–º—ñ–∂–Ω—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö –Ω–∞ –¥–æ–¥–∞—Ç–æ–∫ –¥–æ "–æ—Å–Ω–æ–≤–Ω–æ–≥–æ" –º—ñ—Å—Ü—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –æ–±'—î–∫—Ç–∞. –Ø–∫—â–æ –æ–±'—î–∫—Ç –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞ —ñ –Ω—ñ–¥–µ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è, –∫—Ä—ñ–º —è–∫ –≤ —è–∫–æ—Å—Ç—ñ –∫–ª—é—á–∞ –≤ `WeakMap` –∞–±–æ –≤` WeakSet`, —Ç–æ –≤—ñ–Ω –±—É–¥–µ –≤–∏–ª—É—á–µ–Ω–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.
